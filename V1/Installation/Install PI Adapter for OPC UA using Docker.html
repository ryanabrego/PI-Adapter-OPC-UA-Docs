<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Install PI Adapter for OPC UA using Docker </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Install PI Adapter for OPC UA using Docker ">
    <meta name="generator" content="docfx 2.56.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../V1/index.html" width="46">
                <img id="logo" src="../../V1/main/V1/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="InstallPIAdapterForOPCUAUsingDocker">
<h1 id="install-pi-adapter-for-opc-ua-using-docker">Install PI Adapter for OPC UA using Docker</h1>

<p>Docker is a set of tools that you can use on Linux to manage application deployments.</p>
<p><strong>Note:</strong> If you want to use Docker, you must be familiar with the underlying technology and have determined that it is appropriate for your planned use of the OPC UA adapter. Docker is not a requirement to use OPC UA adapter.</p>
<p>This topic provides examples of how to create a Docker container with the OPC UA adapter.</p>
<h2 id="create-a-startup-script-for-the-adapter">Create a startup script for the adapter</h2>
<ol>
<li><p>Using any text editor, create a script similar to the following.</p>
<p> <strong>Note:</strong> The script varies slightly by processor.</p>
<p> <strong>ARM32</strong></p>
<pre><code class="lang-bash">#!/bin/sh
#local variables
defaultPort=5590
#regexp to only accept numerals
re=&#39;^[0-9]+$&#39;

portConfigFile=&quot;/OpcUa_linux-arm/appsettings.json&quot;

#validate the port number input
if [ -z $portnum ] ; then
        portnum=${defaultPort}
        echo &quot;Default value selected.&quot; ;
else
        echo $portnum | grep -q -E $re
        isNum=$?
        if [ $isNum -ne 0 ] || [ $portnum -le 1023 ] || [ $portnum -gt 49151 ] ; then
                echo &quot;Invalid input. Setting default value ${defaultPort} instead...&quot;
                portnum=${defaultPort} ;
        fi
fi

echo &quot;configuring port ${portnum}&quot;
#write out the port config file
cat &gt; ${portConfigFile} &lt;&lt; EOF
{
&quot;ApplicationSettings&quot;: {
        &quot;Port&quot;: ${portnum},
        &quot;ApplicationDataDirectory&quot;: &quot;/usr/share/OSIsoft/Adapters/OpcUa/OpcUa&quot;
        }
}
EOF
exec /OpcUa_linux-arm/OSIsoft.Data.System.Host
</code></pre><p> <strong>ARM64</strong></p>
<pre><code class="lang-bash">#!/bin/sh
#local variables
defaultPort=5590
#regexp to only accept numerals
re=&#39;^[0-9]+$&#39;

portConfigFile=&quot;/OpcUa_linux-arm64/appsettings.json&quot;

#validate the port number input
if [ -z $portnum ] ; then
        portnum=${defaultPort}
        echo &quot;Default value selected.&quot; ;
else
        echo $portnum | grep -q -E $re
        isNum=$?
        if [ $isNum -ne 0 ] || [ $portnum -le 1023 ] || [ $portnum -gt 49151 ] ; then
                echo &quot;Invalid input. Setting default value ${defaultPort} instead...&quot;
                portnum=${defaultPort} ;
        fi
fi

echo &quot;configuring port ${portnum}&quot;
#write out the port config file
cat &gt; ${portConfigFile} &lt;&lt; EOF
{
&quot;ApplicationSettings&quot;: {
        &quot;Port&quot;: ${portnum},
        &quot;ApplicationDataDirectory&quot;: &quot;/usr/share/OSIsoft/Adapters/OpcUa/OpcUa&quot;
        }
}
EOF
exec /OpcUa_linux-arm64/OSIsoft.Data.System.Host
</code></pre><p> <strong>AMD64</strong></p>
<pre><code class="lang-bash">#!/bin/sh
#local variables
defaultPort=5590
#regexp to only accept numerals
re=&#39;^[0-9]+$&#39;

portConfigFile=&quot;/OpcUa_linux-x64/appsettings.json&quot;

#validate the port number input
if [ -z $portnum ] ; then
        portnum=${defaultPort}
        echo &quot;Default value selected.&quot; ;
else
        echo $portnum | grep -q -E $re
        isNum=$?
        if [ $isNum -ne 0 ] || [ $portnum -le 1023 ] || [ $portnum -gt 49151 ] ; then
                echo &quot;Invalid input. Setting default value ${defaultPort} instead...&quot;
                portnum=${defaultPort} ;
        fi
fi

echo &quot;configuring port ${portnum}&quot;
#write out the port config file
cat &gt; ${portConfigFile} &lt;&lt; EOF
{
&quot;ApplicationSettings&quot;: {
        &quot;Port&quot;: ${portnum},
        &quot;ApplicationDataDirectory&quot;: &quot;/usr/share/OSIsoft/Adapters/OpcUa/OpcUa&quot;
        }
}
EOF
exec /OpcUa_linux-x64/OSIsoft.Data.System.Host
</code></pre></li>
<li><p>Name the script <em>opcuadockerstart.sh</em> and save it to the directory where you plan to create the container.</p>
</li>
</ol>
<h2 id="create-a-docker-container-containing-the-opc-ua-adapter">Create a Docker container containing the OPC UA adapter</h2>
<ol>
<li><p>Create the following Dockerfile in the directory where you want to create and run the container.</p>
<p> <strong>Note:</strong> Dockerfile is the required name of the file. Use the variation according to your operating system:</p>
<p> <strong>ARM32</strong></p>
<pre><code class="lang-bash">FROM ubuntu
WORKDIR /
RUN apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends libicu60 libssl1.0.0
COPY opcuadockerstart.sh /
RUN chmod +x /opcuadockerstart.sh
ADD ./OpcUa_linux-arm.tar.gz .
ENTRYPOINT [&quot;/opcuadockerstart.sh&quot;]
</code></pre><p> <strong>ARM64</strong></p>
<pre><code class="lang-bash">FROM ubuntu
WORKDIR /
RUN apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends libicu60 libssl1.0.0
COPY opcuadockerstart.sh /
RUN chmod +x /opcuadockerstart.sh
ADD ./OpcUa_linux-arm64.tar.gz .
ENTRYPOINT [&quot;/opcuadockerstart.sh&quot;]
</code></pre><p> <strong>AMD64 (x64)</strong></p>
<pre><code class="lang-bash">FROM ubuntu
WORKDIR /
RUN apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends libicu60 libssl1.0.0
COPY opcuadockerstart.sh /
RUN chmod +x /opcuadockerstart.sh
ADD ./OpcUa_linux-x64.tar.gz .
ENTRYPOINT [&quot;/opcuadockerstart.sh&quot;]
</code></pre></li>
<li><p>Copy the <em>OpcUa_linux-&lt;platform&gt;.tar.gz</em> file to the same directory as the Dockerfile.</p>
</li>
<li>Copy the <em>opcuadockerstart.sh</em> script to the same directory.</li>
<li><p>Run the following command line in the same directory (sudo may be necessary):</p>
<pre><code class="lang-bash">docker build -t opcuaadapter .
</code></pre></li>
</ol>
<h2 id="run-the-opc-ua-adapter-docker-container">Run the OPC UA adapter Docker container</h2>
<h3 id="rest-access-from-the-local-host-to-the-docker-container">REST access from the local host to the Docker container</h3>
<p>Complete the following to run the container:</p>
<ol>
<li>Use the docker container image opcuaadapter created previously.</li>
<li><p>Type the following in the command line (sudo may be necessary):</p>
<pre><code class="lang-bash">docker run -d --network host opcuaadapter
</code></pre></li>
</ol>
<p>Port 5590 is accessible from the host and you can make REST calls to OPC UA adapter from applications on the local host computer. In this example, all data stored by the OPC UA adapter is stored in the container itself. When the container is deleted, the data stored is also deleted.</p>
<h3 id="provide-persistent-storage-for-the-docker-container">Provide persistent storage for the Docker container</h3>
<p>Complete the following to run the container:</p>
<ol>
<li>Use the docker container image opcuaadapter created previously.</li>
<li><p>Type the following in the command line (sudo may be necessary):</p>
<pre><code class="lang-bash">docker run -d --network host -v /opcua:/usr/share/OSIsoft/ opcuaadapter
</code></pre></li>
</ol>
<p>Port 5590 is accessible from the host and you can make REST calls to OPC UA adapter from applications on the local host computer. In this example, all data that is written to the container is instead written to the host directory. In this example, the host directory is a directory on the local machine, <em>/opcua</em>. You can specify any directory.</p>
<h3 id="port-number-change">Port number change</h3>
<p>To use a different port other than 5590 you can specify a <strong>portnum</strong> variable on the <code>docker run</code> command line. For example, to start the adapter using port 6000 instead of 5590, you use the command line:</p>
<pre><code class="lang-bash">docker run -d -e portnum=6000 --network host opcuaadapter
</code></pre><p>Instead of accessing the REST API using port 5590 you use port 6000. The following curl command returns the configuration for the container.</p>
<pre><code class="lang-bash">curl http://localhost:6000/api/v1/configuration
</code></pre><h3 id="remove-rest-access-to-the-docker-container">Remove REST access to the Docker container</h3>
<p>If you remove the <code>--network host</code> option from the docker run command, no REST access is possible from outside the container. This may be of value where you want to host an application in the same container as OPC UA adapter and do not want to have external REST access enabled.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/OSIsoft-Adapter-OPC-UA-Docs/blob/master/V1/Installation/Install PI Adapter for OPC UA using Docker.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>© 2020 - OSIsoft, LLC.</span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
