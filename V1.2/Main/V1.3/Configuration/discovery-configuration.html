<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Discovery configuration </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Discovery configuration ">
    <meta name="generator" content="docfx 2.56.5.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../V1/index.html" width="46">
                <img id="logo" src="../../../../V1/Main/V1/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="DiscoveryConfiguration1-3">
<h1 id="discovery-configuration">Discovery configuration</h1>

<p>You can perform a data discovery for existing data pieces on demand. Data discovery is initiated through REST calls and it is tied to a specific discovery Id, which you can either specify or let the adapter generate.</p>
<p> Data discovery includes different routes. For example, you can choose to do the following:</p>
<ul>
<li>Retrieve the discovery results</li>
<li>Query the discovery status</li>
<li>Cancel or delete discoveries</li>
<li>Merge discovery results with the data selection item</li>
<li>Retrieve results from a current discovery and compare it with results from a previous or discovery</li>
<li>Retrieve results from a current discovery and compare it with results from a current data selection configuration</li>
</ul>
<h2 id="configure-discovery">Configure discovery</h2>
<ol>
<li>Start any of the <a class="xref" href="configuration-tools.html">Configuration tools</a> capable of making HTTP requests.</li>
<li><p>Run a <code>POST</code> command with the <code>Id</code> of the discovery and <code>autoSelect</code> set to either <code>true</code> or <code>false</code> to the following endpoint: <code>http://localhost:5590/api/v1/configuration/&lt;ComponentId&gt;/Discoveries</code>.</p>
<p><code>5590</code> is the default port number. If you selected a different port number, replace it with that value.</p>
<p> Example using <code>curl</code>:</p>
<pre><code class="lang-bash">curl -d &quot;{ \&quot;Id\&quot;:\&quot;TestDiscovery\&quot;, \&quot;autoSelect\&quot;:true }&quot; -X POST &quot;http://localhost:5590/api/v1/configuration/&lt;ComponentId&gt;/Discoveries&quot;
</code></pre></li>
</ol>
<!---
## Discovery schema

The full schema definition for the general configuration is in the `<AdapterName>_Discovery_schema.json` file located in one of the following folders:

Windows: `%ProgramFiles%\OSIsoft\Adapters\<AdapterName>\Schemas`

Linux: `/opt/OSIsoft/Adapters/<AdapterName>/Schemas`
--->
<!--
Only Id, Query and AutoSelect will have effect when initiating the discovery query. The other parameters for the 'discovery state' are redundant and will be overridden even if specified in the configuration. To avoid any confusion we could mention only the 3 relevant ones to the customer for configuring discovery. The table below is the State of the discovrery is mainly for intepreting discovery result.
-->
<!--
Thyag:
Specific to MQTT Sparkplug B, the descriptions
Progress = also indicated the number of topics found through the discovery 
-->
<h2 id="discovery-parameters">Discovery parameters</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td> <strong>id</strong></td>
<td><code>string</code></td>
<td>The Id of the discovery. <br><br> <strong>Note:</strong> You cannot run multiple discoveries with the same Id.</td>
</tr>
<tr>
<td> <strong>query</strong></td>
<td><code>string</code></td>
<td>A filter that is specific to the data source. The query filter can limit the scope of the discovery.<br><br>For more information, see the Data source configuration topic.</td>
</tr>
<tr>
<td> <strong>startTime</strong></td>
<td><code>datetime</code></td>
<td>Time when the discovery started.</td>
</tr>
<tr>
<td> <strong>endTime</strong></td>
<td><code>datetime</code></td>
<td>Time when the discovery ended.</td>
</tr>
<tr>
<td> <strong>progress</strong></td>
<td><code>double</code></td>
<td>Progress of the discovery.</td>
</tr>
<tr>
<td> <strong>itemsFound</strong></td>
<td><code>integer</code></td>
<td>Number of data pieces that the discovery found on the data source.</td>
</tr>
<tr>
<td> <strong>newItems</strong></td>
<td><code>integer</code></td>
<td>Number of new data pieces that the discovery found in comparison to the previous discovery.</td>
</tr>
<tr>
<td> <strong>newAssets</strong></td>
<td><code>integer</code></td>
<td>Number of new assets that the discovery found in comparison to the previous discovery.</td>
</tr>
<tr>
<td> <strong>resultUri</strong></td>
<td><code>integer</code></td>
<td>URL at which you can access the results of the discovery.</td>
</tr>
<tr>
<td> <strong>autoSelect</strong></td>
<td><code>boolean</code></td>
<td>When set to <code>true</code>, the result of the discovery gets pushed to the data selection.</td>
</tr>
<tr>
<td> <strong>status</strong></td>
<td><code>reference</code></td>
<td>Status of the discovery, for example <code>Active</code> or <code>Complete</code>.</td>
</tr>
<tr>
<td> <strong>errors</strong></td>
<td><code>string</code></td>
<td>Errors encountered during the discovery.</td>
</tr>
</tbody>
</table>
<h2 id="discoveries-status-example">Discoveries status example</h2>
<p>The following example shows the status of all discoveries. The discovery id in this example was auto-generated.<br>
<strong>Note:</strong> This is an example. It does not necessarily reflect the adapter you are currently using.</p>
<pre><code class="lang-json">[
    {
        &quot;id&quot;: &quot;8ff855f1-a636-490a-bb31-207410a6e607&quot;,
        &quot;query&quot;: null,
        &quot;startTime&quot;: &quot;2020-09-30T19:34:01.8180401+02:00&quot;,
        &quot;endTime&quot;: &quot;2020-09-30T19:34:01.8368776+02:00&quot;,
        &quot;progress&quot;: 30,
        &quot;itemsFound&quot;: 4,
        &quot;newItems&quot;: 0,
        &quot;newAssets&quot;: 0,
        &quot;resultUri&quot;: &quot;http://127.0.0.1:5590/api/v1/Configuration/OpcUa1/Discoveries/8ff855f1-a636-490a-bb31-207410a6e607/result&quot;,
        &quot;autoSelect&quot;: false,
        &quot;status&quot;: &quot;Complete&quot;,
        &quot;errors&quot;: null
    }
]
</code></pre><h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries</td>
<td>GET</td>
<td>Returns status of all discoveries</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries</td>
<td>POST</td>
<td>Initiates a new discovery and returns its Id</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries</td>
<td>DELETE</td>
<td>Cancels and deletes all saved discoveries</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries/<em>discoveryId</em></td>
<td>GET</td>
<td>Gets the status of an individual discovery<br><br><strong>Note:</strong> If a discovery with the specified Id does not exist, you will get an error message</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries/<em>discoveryId</em></td>
<td>DELETE</td>
<td>Cancels and deletes discovery and result</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries/<em>discoveryId</em>/result</td>
<td>GET</td>
<td>Returns the result of a discovery</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries/<em>discoveryId</em>/result?diff=<em>previousId</em></td>
<td>GET</td>
<td>Returns the difference between the result and the previous result</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/dataselection?diff=<em>discoveryId</em></td>
<td>GET</td>
<td>Returns the difference between the data selection configuration and the discovery results</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/discoveries/<em>discoveryId</em>/result</td>
<td>DELETE</td>
<td>Cancels and deletes discovery result.<br><br><strong>Note:</strong> The discovery Id is still valid, but a query will contain a status of <code>canceled</code><br>Only the <strong>Status</strong> property will contain a <code>canceled</code> status, but not the query</td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/dataselection/select?discoveryid=<em>discoveryId</em></td>
<td>POST</td>
<td>Adds the discovered items to data selection with selected set to <code>true</code></td>
</tr>
<tr>
<td>api/v1/configuration/<em>componentId</em>/dataselection/unselect?discoveryid=<em>discoveryId</em></td>
<td>POST</td>
<td>Adds the discovered items to data selection with selected set to <code>false</code></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Replace <em>componentId</em> with the Id of your adapter component, for example OpcUa1.<br>Replace <em>discoveryId</em> with the Id of the discovery for which you want to perform the action.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter/blob/master/V1.3/Configuration/discovery-configuration.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
