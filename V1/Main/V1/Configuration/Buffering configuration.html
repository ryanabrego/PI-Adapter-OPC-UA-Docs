<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Buffering configuration </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Buffering configuration ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../V1/index.html" width="46">
                <img id="logo" src="../../../../V1/main/V1/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="BufferingConfiguration">
<h1 id="buffering-configuration">Buffering configuration</h1>

<p>You can configure PI adapters to buffer data egressed from the adapter to egress and health endpoints. Buffering is configured through the buffering configuration parameters in the system configuration. You can configure buffering as memory only or on disk.</p>
<p><strong>Note:</strong> OSIsoft recommends that you do not modify the default buffering location unless it is necessary. Changes to the buffering configuration parameters only take effect during adapter service startup.</p>
<h2 id="configure-buffering">Configure buffering</h2>
<ol>
<li>Using any text editor, create a file that contains the buffering configuration in the JSON format.<ul>
<li>For content structure, see the sample output in <a href="#examples">Examples - Retrieve the buffering configuration</a>.</li>
<li>For a table of all available parameters, see <a href="#buffering-parameters">Buffering parameters</a>.</li>
</ul>
</li>
<li>Save the file. For example, <code>ConfigureBuffering.json</code>.</li>
<li><p>Use any of the <a class="xref" href="../../../../V1.2/Main/V1/Configuration/Configuration%20tools.html">Configuration tools</a> capable of making HTTP requests and run a <code>PUT</code> command with the contents of the file to the following endpoint: <code>http://localhost:5590/api/v1/configuration/system/buffering</code></p>
<p>  <strong>Note:</strong> <code>5590</code> is the default port number. If you selected a different port number, replace it with that value.</p>
<p>  Example using <code>curl</code>:</p>
<pre><code class="lang-bash"> curl -d &quot;@ConfigureBuffering.json&quot; -H &quot;Content-Type: application/json&quot; -X PUT &quot;http://localhost:5590/api/v1/configuration/system/buffering&quot;
</code></pre><p> <strong>Note:</strong> Run this command from the same directory where the file is located.</p>
</li>
</ol>
<h2 id="buffering-schema">Buffering schema</h2>
<p>The full schema definition for the system buffering is in the <code>System_Buffering_schema.json</code> file located in one of the following folders:</p>
<p>Windows: <code>%ProgramFiles%\OSIsoft\Adapters\AdapterName\Schemas</code></p>
<p>Linux: <code>/opt/OSIsoft/Adapters/AdapterName/Schemas</code></p>
<h2 id="buffering-parameters">Buffering parameters</h2>
<p>The following parameters are available for configuring buffering:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>EnablePersistentBuffering</strong></td>
<td>Optional</td>
<td><code>boolean</code></td>
<td>Enables or disables on-disk buffering <br><br> Allowed value: <code>true</code> or <code>false</code><br>Default value: <code>true</code> <br><br> <strong>Note:</strong> If you disable persistent buffering, in-memory buffering is used. In-memory buffering is limited by value in the MaxBufferSizeMB property.</td>
</tr>
<tr>
<td><strong>MaxBufferSizeMB</strong></td>
<td>Optional</td>
<td><code>integer</code></td>
<td>Defines the maximum size of the buffer files that are persisted on disk <sup>1</sup> or used in memory <sup>2</sup> when EnablePersistentBuffering is set to false per configured endpoint. The unit is specified in MB (1 Megabyte = 1048576 bytes). Consider the capacity and the type of storage medium to determine a suitable value for this parameter. <br><br>Minimum value: <code>1</code><br>Maximum value:  <code>2147483647</code><br> Default value: <code>1024</code></td>
</tr>
<tr>
<td><strong>BufferLocation</strong></td>
<td>Required</td>
<td><code>string</code></td>
<td>Defines the location of the buffer files. Absolute paths are required. Consider the access-control list (ACL) when you set this parameter. <br><br> Allowed value: Valid path to a folder location in the file system <br> Default value: <br> <strong>Windows:</strong> <em>%ProgramData%\OSIsoft\Adapters\{AdapterInstance}\Buffers</em> <br> <strong>Linux:</strong> <em>/usr/share/OSIsoft/Adapters/{AdapterInstance}/Buffers</em></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> <strong>Buffering to disk</strong> - disk is only used if required; <br> </p>
<ul>
<li>The MaxBufferSizeMB per an endpoint and buffer file is 20MB of storage.<br></li>
<li>When MaxBufferSizeMB is reached, the oldest buffer file is deleted and a new buffer file created.<br></li>
<li>When the buffer file of a MaxBufferSizeMB of 20MB fills, a new buffer file is created and the previous buffer file deleted.</li>
</ul>
<p><strong>Note:</strong> The following rules apply in case of an error when creating a new buffer file:</p>
<ul>
<li>Attempt to delete oldest buffer file and retry.</li>
<li>If unable to buffer, errors are logged to indicate data loss.</li>
<li>If a buffer file is corrupted, an attempt is made to recover individual records and any failure to recover records is logged.</li>
</ul>
<p><sup>2</sup> <strong>Buffering only to memory</strong>:<br></p>
<ul>
<li>The MaxBufferSizeMB of health endpoints is limited to 20MB of memory.<br></li>
<li>When MaxBufferSizeMB is reached, only the oldest message in the memory buffer is removed. Depending on the size of a new message, several old messages are removed.<br></li>
</ul>
<h2 id="examples">Examples</h2>
<p>The following examples are buffering configurations made through the<code>curl</code> REST client.</p>
<h3 id="retrieve-the-buffering-configuration">Retrieve the buffering configuration</h3>
<pre><code class="lang-cmd">curl -X GET &quot;http://localhost:5590/api/v1/configuration/system/buffering&quot;
</code></pre><p>Sample output:</p>
<pre><code class="lang-code">{
    &quot;bufferLocation&quot;: &quot;C:/ProgramData/OSIsoft/Adapters/Modbus/Buffers&quot;,
    &quot;maxBufferSizeMB&quot;: 1024,
    &quot;enablePersistentBuffering&quot;: true
}
</code></pre><p><code>200 OK</code> response indicates success.</p>
<h3 id="update-maxbuffersizemb-parameter">Update MaxBufferSizeMb parameter</h3>
<pre><code class="lang-cmd">curl -d &quot;{ &quot;MaxBufferSizeMB&quot;: 100 }&quot; -H &quot;Content-Type: application/json&quot; -X PATCH &quot;http://localhost:5590/api/v1/configuration/system/buffering&quot;
</code></pre><p><code>204 No Content</code> response indicates success.</p>
<h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/system/buffering</td>
<td>GET</td>
<td>Gets the buffering configuration</td>
</tr>
<tr>
<td>api/v1/configuration/system/buffering</td>
<td>PUT</td>
<td>Replaces the existing buffering configuration</td>
</tr>
<tr>
<td>api/v1/configuration/system/buffering</td>
<td>PATCH</td>
<td>Update parameter, partial configuration</td>
</tr>
</tbody>
</table>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter/blob/master/V1/Configuration/Buffering configuration.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2020 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
